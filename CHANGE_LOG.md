# ScrcpyGUI 群控功能修复日志

## 问题描述

1. 点击"连接所有设备"按钮只连上一个设备，窗口无法移动
2. 群控功能无效：操作主设备时，从设备没有响应
3. 进程销毁错误：QProcess被提前销毁导致崩溃
4. 不同型号设备间坐标转换不准确，无法有效控制

## 修复内容

### 1. 进程管理修复

- 添加`process_tracking`列表防止进程被过早销毁
- 改进`cleanup_processes`方法，增加错误处理机制和超时时间
- 增强对象销毁检查，防止访问已销毁对象
- 修复`log`方法，增加防御性检查

### 2. 窗口定位和显示

- 移除`--window-borderless=false`参数错误
- 增加窗口间距，防止窗口完全重叠
- 增加窗口边距参数，确保标题栏可见便于移动
- 确保窗口位置和大小正确设置

### 3. 事件监控优化

- 改进`ScrcpyEventMonitor`类，增加窗口自动发现机制
- 保存已找到窗口的标题，提高窗口识别率
- 将触摸事件延迟从300ms增加到500ms，提高操作稳定性
- 将长按操作判断从0.5秒增加到1秒
- 使用屏幕区域映射替代精确坐标转换，适应不同尺寸设备
- 增强方向感知，适配不同方向的设备

### 4. 坐标转换增强

- 实现9区域映射方案，将屏幕分为九个区域进行映射
- 添加随机偏移，避免点击同一个精确位置可能导致的问题
- 实现基于方向的滑动手势转换，使不同方向设备滑动效果一致
- 为不同方向设备间的操作映射添加智能转换

### 5. 命令执行优化

- 优化`send_touch_event`方法，增强错误处理
- 增加命令超时时间从5秒提高到8秒
- 点击操作增加0.5秒延迟，长按操作增加1秒延迟
- 添加命令重试机制，失败时尝试附近位置重新点击
- 确保设备间命令顺序执行而非并行执行

### 6. 用户体验改进

- 添加更多有用的日志信息，使用emoji增强可读性
- 添加操作状态跟踪和反馈
- 实现同步成功/失败率统计
- 改进错误提示和错误处理
- 增加更多用户操作提示

### 7. 稳定性增强

- 添加详细的异常捕获和错误记录
- 改进定时器管理和释放
- 修复Lambda函数传参问题
- 优化设备方向检测和处理逻辑

## 注意事项

- 操作设备前确保所有设备处于相似界面
- 操作之间需留出足够时间让系统同步
- 滑动操作需慢一些，停留片刻再松开
- 屏幕方向不一致可能会影响操作精度
- 如遇问题，尝试点击目标窗口使系统识别它

## 2023-09-10 更新
- 支持创建不同尺寸的自定义图标
- 简化配置文件结构，优化设置载入
- 增强了应用管理器的性能
- 修复应用列表刷新时可能的崩溃问题

## 2023-11-05 更新
- 修复分辨率和码率设置在某些设备上的兼容性问题
- 添加了USB断开自动重连功能
- 改进窗口布局算法，支持多设备同时布局
- 增加设备连接状态的实时监控
- 适配最新版本scrcpy 2.0接口变化

## 2023-12-18 更新
- 添加了多设备同步群控功能
- 支持设备间的拖拽文件传输
- 优化了WiFi连接的稳定性
- 增加了连接设备的历史记录功能
- 添加命令行参数解析，支持直接启动应用管理器

## 2024-01-22 更新
- 修复了Windows 11下的UI缩放问题
- 改进了应用管理器的搜索功能
- 优化了设备截图的处理逻辑
- 添加了深色模式支持

## 2024-03-15 更新
- 修复了多设备窗口布局的问题
- 改进多设备同步功能，增加事件记录
- 优化了截图压缩算法，提高截图质量
- 增加了远程调试接口

## 2024-06-05 更新 (v1.5.0)
- 添加集成scrcpy环境功能，无需全局安装scrcpy
- 自动检测和使用项目目录下的scrcpy-win64-v3.2
- 新增setup_scrcpy.py脚本，实现一键下载配置scrcpy环境
- 重构控制器代码，支持多种scrcpy路径的自动检测
- 优化群控功能的事件同步机制
- 改进窗口排列算法，更好地适应多种分辨率显示器
- 修复了部分字符编码导致的路径问题 